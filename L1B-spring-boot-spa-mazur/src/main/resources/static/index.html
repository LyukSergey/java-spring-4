<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Prod App Demo</title>
    <script src="http://localhost:8081/js/keycloak.js"></script>
    <style> body { font-family: sans-serif; padding: 2em; } button { padding: 10px; margin: 5px; } pre { background-color: #eee; padding: 1em; } </style>
</head>
<body>
<h1>Prod-Ready –î–µ–º–æ</h1>
<div>–°—Ç–∞—Ç—É—Å: <span id="status">–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è...</span></div>
<hr>
<button id="loginBtn" onclick="keycloak.login()">–£–≤—ñ–π—Ç–∏</button>
<button id="logoutBtn" onclick="keycloak.logout()">–í–∏–π—Ç–∏</button>
<hr>
<button id="apiBtn" onclick="callApi()">–í–∏–∫–ª–∏–∫–∞—Ç–∏ –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –µ–Ω–¥–ø–æ—ñ–Ω—Ç (/private)</button>
<div id="api-response" style="margin-top: 1em;"></div>
<h3>–¢–æ–∫–µ–Ω:</h3>
<pre id="token-info">–ù–µ–º–∞—î —Ç–æ–∫–µ–Ω—É.</pre>

<script>
    // 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç–∞
    const keycloak = new Keycloak({
        url: 'http://localhost:8180',
        realm: 'my-prod-app-realm',
        clientId: 'my-webapp-client'
    });

    // 3. –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
    keycloak.init({ onLoad: 'check-sso' }).then(authenticated => {
        updateUI(authenticated);
    });

    function updateUI(authenticated) {
        document.getElementById('logoutBtn').style.display = authenticated ? 'inline-block' : 'none';
        document.getElementById('apiBtn').style.display = authenticated ? 'inline-block' : 'none';
        document.getElementById('loginBtn').style.display = authenticated ? 'none' : 'inline-block';
        document.getElementById('status').textContent = authenticated ? '–ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π' : '–ù–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π';
        document.getElementById('token-info').textContent = authenticated ? JSON.stringify(keycloak.tokenParsed, null, 2) : '–ù–µ–º–∞—î —Ç–æ–∫–µ–Ω—É.';
    }

    // 4. –í–∏–∫–ª–∏–∫ API
    function callApi() {
        const apiResponseDiv = document.getElementById('api-response');
        apiResponseDiv.textContent = '–í–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∑–∞–ø–∏—Ç...';

        // üîÑ –û–Ω–æ–≤–ª—é—î–º–æ —Ç–æ–∫–µ–Ω
        keycloak.updateToken(5).then(function () {
            fetch('http://localhost:8080/private', {
                headers: {
                    'Authorization': 'Bearer ' + keycloak.token
                }
            })
                .then(response => {
                    if (response.status === 401) throw new Error("401 Unauthorized");
                    return response.text();
                })
                .then(data => { apiResponseDiv.textContent = '–í—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ —Å–µ—Ä–≤–µ—Ä–∞: ' + data; })
                .catch(error => { apiResponseDiv.textContent = '–ü–æ–º–∏–ª–∫–∞: ' + error; });
        }).catch(function () {
            apiResponseDiv.textContent = '–ù–µ –≤–¥–∞–ª–æ—Å—è –æ–Ω–æ–≤–∏—Ç–∏ —Ç–æ–∫–µ–Ω. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–π—à–æ–≤?';
        });
    }

</script>
</body>
</html>